<?
$accessLevel = $this->driver->getAccessLevel();
$restrictedView = empty($accessLevel) ? false : true;
$recordId = $this->driver->getUniqueID();
$recordSource = explode(".", $recordId)[0];
$format = $this->driver->getPubTypeId();
$items = $this->driver->getItems();
$lookfor = $this->results->getUrlQuery()->isQuerySuppressed() ? '' : $this->params->getDisplayQuery();
//var_dump($this->driver); exit();
//var_dump($items); exit();
if (empty($lookfor)) {
    $lookfor = $this->record($this->driver)->getObalkyKnihAdvert('results');
}
?>
<div class="white-box clearfix">
    <div class="row col-xs-12 source<?=$this->escapeHtmlAttr($this->driver->getSourceIdentifier())?> recordId<?=$this->driver->supportsAjaxStatus()?' ajaxItemId':''?>">
        <input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>" class="hiddenId" />
        <div class="col-sm-2 col-xs-3 left">

            <div class="coverThumbnail cover_<?=$recordId?>">

                <? if ($bibinfo = $this->record($this->driver)->getObalkyKnihJSONV3()): ?>
                    <script type="text/javascript">
                        <? if ($this->driver instanceof CPK\RecordDriver\SolrAuthority): ?>
                        obalky.display_authority_results(".cover_<?=$recordId?>", <?=$bibinfo?>, <?=json_encode($lookfor)?>);
                        <? else: ?>
                        obalky.display_thumbnail_cover_without_links(".cover_<?=$recordId?>", <?=$bibinfo?>, <?=json_encode($lookfor)?>);
                        <? endif; ?>
                    </script>
                <? endif;?>
                <? if (! empty($format)): ?>
                    <div class="iconlabel"><i style="font-size: 70px; color: #cccccc;" class="pr-format-eds-<?=$format?>"></i></div>
                <? elseif ($summThumb = $this->record($this->driver)->getThumbnail()): ?>
                    <img class="recordcover" src="<?=$this->escapeHtmlAttr($summThumb)?>" alt="<?=$this->transEsc('Cover Image')?>"/>
                <? else: ?>
                    <img class="recordcover" src="<?=$this->url('cover-unavailable')?>" alt="<?=$this->transEsc('No Cover Image')?>"/>
                <? endif; ?>
            </div>

        </div>
        <div class="col-sm-7 col-xs-7 middle search-result-container">
            <?  $items  =  $this->driver->getItems();
            if (isset($items) && !empty($items)) :
                foreach ($items as $item):
                    if (!empty($item)): ?>
                        <div class="resultItemLine1">
                            <? if ('Ti' == $item['Group']): ?>
                                <div class="root-title">
                                    <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title _record_link">
                                        <?=$item['Data']?>
                                    </a>
                                </div>
                            <? elseif ('Au' == $item['Group']): $author = $item['Data'];?>
                                <span title='<?=$this->translate('Show publications by')?> <?=strip_tags($author)?>' class='eds-author-info'>
                                    <?=$author?>
                                </span>
                            <? else: ?>
                                <p>
                                    <b><?=$this->transEsc($item['Label'])?>:</b>
                                    <?=$item['Data']?>
                                </p>
                            <? endif; ?>
                        </div>
                    <? endif;
                endforeach;
            elseif ($restrictedView): ?>
                <div class="resultItemLine1">
                    <p>
                        <?=$this->transEsc('This result is not displayed to guests')?>
                        <br />
                        <a class="login" href="<?=$this->url('myresearch-home')?>">
                            <strong><?=$this->transEsc('Login for full access')?></strong>
                        </a>
                    </p>
                </div>
            <? endif; ?>

            <div class='row'>
                <div class='col-md-8'>
                    <div class="format-list pull-left inline-block">
                        <? if (! empty($format)): ?>
                            <div class="iconlabel" style="color: #777;">
                                <i class="small-format-icon pr-format-eds-<?=$format?>"></i>
                                <span class="format-text">
                                    <?= $this->translate($format) ?>
                                </span>
                            </div>
                        <? endif; ?>
                    </div>
                </div>
                <div class='col-md-4 search-results-favorite-button hidden pull-right'>
                    <? if ($this->userlist()->getMode() !== 'disabled'):
                        $controllerClass = 'controller:' . $this->record($this->driver)->getController();
                        $handleOfflineFavorites = ! $this->isLoggedIn && $this->offlineFavoritesEnabled; ?>
                        <li class="list-group-item">
                            <a id="save-record" class="modal-link <?=$controllerClass?>"

                                <? if ($handleOfflineFavorites) : ?>
                                    href="#" data-ng-click="searchFavCtrl.addOrRemoveFavorite(<?=isset($_ENV['currentRecordNo']) ? $_ENV['currentRecordNo'] : '' ?>)"
                                <? else: ?>
                                    href="<?=$this->recordLink()->getActionUrl($this->driver, 'Save')?>"
                                <? endif; ?>

                               title="<?=$this->transEsc('Add to favorites')?>" rel="nofollow"><i class="pr-interface-favoritestar"> </i>
                                <span data-add-remove-search="add<?=isset($_ENV['currentRecordNo']) ? ':' . $_ENV['currentRecordNo'] : '' ?>"><?=$this->transEsc('Add to favorites')?></span>
                                <span data-add-remove-search="rem<?=isset($_ENV['currentRecordNo']) ? ':' . $_ENV['currentRecordNo'] : '' ?>" hidden ><b><?=$this->transEsc('remove_from_favorites')?></b></span>
                            </a></li>
                    <? endif; ?>
                </div>
            </div>
          
        </div>

        <div class="col-sm-3 col-xs-12 right">

        </div>

        <!--<div class="col-sm-2 right hidden-print">
            <? /* Display qrcode if appropriate: */ ?>
            <? if ($QRCode = $this->record($this->driver)->getQRCode("results")): ?>
                <?
                // Add JS Variables for QrCode
                $this->jsTranslations()->addStrings(array('qrcode_hide' => 'qrcode_hide', 'qrcode_show' => 'qrcode_show'));
                ?>
                <span class="hidden-xs">
            <i class="fa fa-fw fa-qrcode"></i> <a href="<?=$this->escapeHtmlAttr($QRCode);?>" class="qrcodeLink"><?=$this->transEsc('qrcode_show')?></a>
            <div class="qrcode hidden">
              <script type="text/template" class="qrCodeImgTag">
                <img alt="<?=$this->transEsc('QR Code')?>" src="<?=$this->escapeHtmlAttr($QRCode);?>"/>
              </script>
            </div><br/>
          </span>
            <? endif; ?>

            <? if ($this->userlist()->getMode() !== 'disabled'): ?>
                <? /* Add to favorites */ ?>
                <i class="fa fa-fw fa-star"></i> <a href="<?=$this->recordLink()->getActionUrl($this->driver, 'Save')?>" class="save-record modal-link" id="<?=$this->driver->getUniqueId() ?>" title="<?=$this->transEsc('Add to favorites')?>"><?=$this->transEsc('Add to favorites')?></a><br/>

                <? /* Saved lists */ ?>
                <div class="savedLists alert alert-info hidden">
                    <strong><?=$this->transEsc("Saved in")?>:</strong>
                </div>
            <? endif; ?>

            <? /* Hierarchy tree link */ ?>
            <? $trees = $this->driver->tryMethod('getHierarchyTrees'); if (!empty($trees)): ?>
                <? foreach ($trees as $hierarchyID => $hierarchyTitle): ?>
                    <div class="hierarchyTreeLink">
                        <input type="hidden" value="<?=$this->escapeHtmlAttr($hierarchyID)?>" class="hiddenHierarchyId" />
                        <i class="fa fa-fw fa-sitemap"></i>
                        <a class="hierarchyTreeLinkText modal-link" href="<?=$this->recordLink()->getTabUrl($this->driver, 'HierarchyTree')?>?hierarchy=<?=urlencode($hierarchyID)?>#tabnav" title="<?=$this->transEsc('hierarchy_tree')?>">
                            <?=$this->transEsc('hierarchy_view_context')?><? if (count($trees) > 1): ?>: <?=$this->escapeHtml($hierarchyTitle)?><? endif; ?>
                        </a>
                    </div>
                <? endforeach; ?>
            <? endif; ?>
        </div>-->

        <!--<div class="format-list pull-left inline-block">
            <?=$this->record($this->driver)->getFormatList()?>
        </div>-->

    </div>
</div>
