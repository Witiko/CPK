(function(){angular.module("federativeLogin",[])})();(function(){function f(d){function e(){!1===c&&h();return b}function h(){b=localStorage.getItem("__luidps");if(null===b)b=[];else{try{b=JSON.parse(b)}catch(m){d.error("Could not parse lastIdps from localStorage",m),b=[]}var a=document.body.parentNode.getAttribute("lang"),e=location.pathname+location.search;e+=(0<=e.indexOf("?")?"&":"?")+"auth_method=Shibboleth";b.forEach(function(c){c.name=c["name_"+a];c.href=c.href.replace(/target=[^&]*/,"target="+encodeURIComponent(e))})}c=!0}var b=[],c=!1,a=!0;
this.login=function(c){"string"===typeof c&&(c=JSON.parse(c));if(!c.isConsolidation){e();for(var a=b.length,d=0;d<a;++d)if(b[d].name===c.name){b.splice(d,1);break}b.unshift(c);3<b.length&&b.pop();a=JSON.stringify(b);localStorage.setItem("__luidps",a)}c.warn_msg&&alert(VuFind.translate("warning_safety_login"));window.location.replace(c.href)};this.hasLastIdps=function(){e();return null!==b&&b instanceof Array&&0!==b.length};this.getLastIdps=e;this.showHelpContent=function(){a?g.helpContent.removeAttribute("hidden"):
g.helpContent.setAttribute("hidden","hidden");a=!a};return this}angular.module("federativeLogin").controller("FederativeLoginController",f).directive("ngLastUsed",function(){return{restrict:"A",templateUrl:"/themes/bootstrap3/js/ng-cpk/federative-login/last-used.html"}}).directive("ngHelpContent",function(){return{restrict:"A",link:function(d,e,h){g.helpContent=e.context}}});f.$inject=["$log"];var g={lastUsed:void 0}})();(function(){angular.module("notifications",[])})();(function(){function f(b,c,a,z,f){function m(c,a,b){c instanceof Array&&(p.notifications[b]=c,0!==c.length?(c.forEach(function(c){c.clazz.match(/unread/)&&++t}),q(),n()):l(e[a+".parent"]),k(a))}function g(c){c instanceof Array&&(p.notifications.noAPI.user=c,0!==c.length&&(c.forEach(function(c){c.clazz.match(/unread/)&&++t}),q(),n()))}function u(b){return new Promise(function(d,e){a.post("/AJAX/JSON?method=getMyNotificationsForUserCard",$.param({cat_username:b}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){a=
a.data.data;"object"===typeof a.errors&&a.errors.forEach(function(a){c.error(a)});"undefined"!==typeof a.notifications?(d(a.notifications),0==a.notifications.length&&$("ul#notificationsList>li#"+a.source).append('<div class="notif-default">'+VuFind.translate("without_notifications")+"</div>")):e("No notifications returned!")},function(c){e(c)})})}function r(){return new Promise(function(b,d){a({method:"GET",url:"/AJAX/JSON?method=getMyNotificationsForUser"}).then(function(a){a=a.data.data;"object"===
typeof a.errors&&a.errors.forEach(function(a){c.error(a)});"undefined"!==typeof a.notifications?b(a.notifications):d("No notifications returned!")},function(a){d(a)})})}function k(a){"undefined"===typeof a?d.loader.setAttribute("hidden","hidden"):e[a].setAttribute("hidden","hidden");x()||l(d.parent)}function n(){d.warningIcon.style.display=""}function q(){0>t&&(t=0);d.unreadNotifsCount.textContent=t||""}function l(a){a.setAttribute("hidden","hidden")}function x(){var a="object"===typeof p.notifications.noAPI.user&&
0!==p.notifications.noAPI.user.length;return 0!==d.synchronousNotifications.children.length||a}function y(){v=!0;"function"===typeof w&&w.call()}var v=!1,w,t=0,p=this;p.notifications={};p.initApiRelevantNotificationsForUserCard=function(a,d){p.notifications[d]=[];b.resolve(u(d)).then(function(c){m(c,a,d)})["catch"](function(a){c.error(a)})};p.initApiNonrelevantNotifications=function(){p.notifications.noAPI={};p.notifications.noAPI.user=[];b.resolve(r()).then(function(a){g(a);y()})["catch"](function(a){c.error(a);
y()})};p.notifClicked=function(c,b){var d=c.clazz,e=c.href,v=c.type;d.match(/unread/)&&(--t,q(),c.clazz=d.replace(/[^\s]*unread/,""));"undefined"!==typeof e&&a.post("/AJAX/JSON?method=notificationRead",$.param({notificationType:v,source:b}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(){"user"===b?z.url(e):location.href=e;f.$broadcast("notificationClicked")})};h=function(){x()?n():v?l(d.parent):w=h};return p}function g(b){return{restrict:"A",link:function(c,a,b){switch(b.globalNotif){case "loader":d.loader=
a.context;break;case "parent":d.parent=a.context;break;case "synchronousNotifications":d.synchronousNotifications=a.context;break;case "warningIcon":d.warningIcon=a.context;break;case "unreadNotifsCount":d.unreadNotifsCount=a.context;break;default:console.error("Linker for notifications controller failed to link global notifications element")}"undefined"===typeof buf&&(buf={},buf.globalNotifHolderKeys=Object.keys(d),buf.globalNotifHolderKeysLength=buf.globalNotifHolderKeys.length);for(c=0;c<buf.globalNotifHolderKeysLength&&
"undefined"!==typeof d[buf.globalNotifHolderKeys[c]];)++c===buf.globalNotifHolderKeysLength&&("function"===typeof h?h():$log.error("onLinkerDone must be a function"))}}}angular.module("notifications").controller("NotificationsController",f).directive("globalNotif",g).directive("institutionNotif",function(){return{restrict:"A",link:function(b,c,a){e[a.institutionNotif]=c.context}}});f.$inject=["$q","$log","$http","$location","$rootScope"];g.$inject=["$log"];var d={loader:void 0,parent:void 0,synchronousNotifications:void 0,
warningIcon:void 0,unreadNotifsCount:void 0},e={},h=function(){}})();(function(){angular.module("admin",[])})();(function(){function f(){function d(){c.input.className+=" hidden";c.div.removeAttribute("hidden")}function e(a){if(""===a){var b=c.input.required;if("number"===c.input.type)a=c.input.currentTableRow.input.placeholder;else if(b)return!1}b=c.div.getElementsByTagName("ins");if(0===b.length){b=c.div.textContent.trim();if(b===a.trim())return!0;b.length&&(c.div.innerHTML='<del style="color: red">'+b+"</del><br>");b=document.createElement("ins");b.style.color="green";c.div.appendChild(b)}else{var d=c.div.getElementsByTagName("del");
if(d.length&&(d=d[0].textContent.trim(),d===a.trim()))return c.div.innerHTML=d,!0;b=b[0]}b.textContent=a;return!0}function h(){var a=c.div.getElementsByTagName("ins");return 0===a.length?c.div.textContent.trim():a[0].textContent.trim()}var b=void 0,c={div:void 0,input:void 0};this.edit=function(a){c.div=a.currentTarget.children[0];c.input=c.div.nextElementSibling;c.input.className=c.input.className.replace(/\shidden|hidden\s?/g,"");c.div.setAttribute("hidden","hidden");c.input.focus();b=(new Date).getTime()};
this.inputKeyDown=function(a){13===a.keyCode?(a.preventDefault(),e(a.target.value)?d():g.click()):27===a.keyCode&&(a.target.value=h(),d())};this.inputBlurred=function(a){"number"===a.target.type&&(new Date).getTime()-100<b||(e("checkbox"===a.target.type?a.target.checked?"1":"0":a.target.value)||(a.target.value=h()),d())};return this}angular.module("admin").controller("ApprovalController",f).directive("ng-submit-approval",function(){return{restrict:"A",link:function(d,e,h){g=e.context}}});f.$inject=
[];var g=void 0})();(function(){angular.module("history",[])})();(function(){function f(e,h,b,c){function a(a){k.removeAttribute("hidden");l.historyPage=[];n=a;B();e.resolve(f()).then(function(a){var b=a.historyPage;(new Promise(function(a){k.setAttribute("hidden","hidden");l.historyPage=b;return a()})).then(c.$applyAsync).then(m(a.obalky))})["catch"](function(a){h.error(a)})}function f(){return new Promise(function(a,c){var d=n-1;if("undefined"!==typeof q[d])return a(q[d]);b.post("/AJAX/JSON?method=getMyHistoryPage",$.param({cat_username:r,page:n,perPage:l.perPage}),
{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){b=b.data;"undefined"!==typeof b.php_errors&&h.error(b.php_errors);if("OK"===b.status)if(q[d]=b.data,"undefined"!==typeof b.data.html&&"undefined"!==typeof b.data.source)$("div#"+b.data.source).html(b.data.html);else return a(b.data);else return c(b.data)})})}function u(a,b){k=a;r=b;e.resolve(f()).then(function(a){var b=a.historyPage,e=a.totalPages;0<e&&(d[r].className=d[r].className.replace("hidden",""));q=Array(e);q[0]=
a;A();(new Promise(function(a){k.setAttribute("hidden","hidden");l.historyPage=b;a()})).then(c.$applyAsync).then(m(a.obalky))})["catch"](function(a){k.innerHTML='<span class="label label-danger">'+a.message+"</span>"})}function m(a){if("undefined"!==typeof a)for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];obalky.fetchImage(b,c.bibInfo,c.advert,"icon")}}function A(){for(var b=[],d=[],e=q.length,f=0;f<e;)d[f++]={number:f,clazz:1===f?"active":""},5>=f&&(b[f-1]=d[f-1]);c.paginator={lastPage:e,visiblePages:b,
pages:d,activePage:1,showFirst:!1,showLast:5<e,goToPage:a}}function B(){(new Promise(function(b){var d=c.paginator.pages;d[c.paginator.activePage-1].clazz="";d[n-1].clazz="active";var e=c.paginator.lastPage,f=3<n,h=n<e-2,m=[],g=n+2,k=3;g>e&&(k=g-e+k,g=e);k=n-k;for(var l=0;k<g;++l,++k)0>k&&(g-=k,g>e&&(g=e),k=0),h&&k===e-1||f&&0===k?--l:m[l]=d[k];c.paginator={lastPage:e,visiblePages:m,pages:d,activePage:n,showFirst:f,showLast:h,goToPage:a};b()})).then(c.$applyAsync)}var r=void 0,k=void 0,n=1,q=[];g=
u;var l=this;l.historyPage=[];l.pageSelected=a;l.perPage="10";l.perPageUpdated=function(){(new Promise(function(a){n=c.paginator.lastPage=1;l.historyPage=[];k.removeAttribute("hidden");a()})).then(c.$applyAsync);q=[];u(k,r)};return l}angular.module("history").controller("CheckedOutHistoryController",f).directive("ngHistoryUsername",function(){return{restrict:"A",link:function(d,f,b){g(f.context,b.ngHistoryUsername)}}}).directive("ngHistoryItem",function(){return{restrict:"A",templateUrl:"/themes/bootstrap3/js/ng-cpk/history/history-item.html"}}).directive("ngPagination",
function(){return{restrict:"A",templateUrl:"/themes/bootstrap3/js/ng-cpk/pagination.html",link:function(d,f,b){d.source=b.ngPagination}}}).directive("ngPagesCount",function(){return{restrict:"A",link:function(e,f,b){d[b.ngPagesCount]=f.context}}}).filter("urlencode",function(){return function(d){return encodeURI(d)}});f.$inject=["$q","$log","$http","$scope"];var g=function(){},d={}})();(function(){angular.module("cpk",["notifications","federativeLogin","admin","history"]).config(["$locationProvider",function(f){f.html5Mode({enabled:!0,requireBase:!1,rewriteLinks:!1})}])})();(function(){function f(b,c,a,e){function f(b){g("global",function(){new Promise(function(){"undefined"===typeof h&&(h=$("#modal"));h.modal("show")});var c=d.modal.global.header,f=d.modal.global.body;e.get("/AJAX/JSON?method=getPortalPage&prettyUrl="+b).then(function(a){a=a.data.data;c.textContent=a.title;f.innerHTML=a.content},function(b){a.error(b)})})}var m=this;m.getParams=c.search();"undefined"!==typeof m.getParams.viewModal&&f(m.getParams.viewModal);b.$on("notificationClicked",function(){m.getParams=
c.search();"undefined"!==typeof m.getParams.viewModal&&f(m.getParams.viewModal,a,e)});return m}function g(b,c){"undefined"===typeof e.modal[b]&&(e.modal[b]={});if("function"===typeof c){var a=e.modal[b].linkerDone;"boolean"===typeof a&&a?c.call():e.modal[b].callback=c}else{a=!0;for(var f=Object.keys(d.modal[b]),g=f.length,h=0;h<g;++h)if("undefined"===typeof d.modal[b][f[h]]){a=!1;break}a&&(e.modal[b].linkerDone=!0,"function"===typeof e.modal[b].callback&&e.modal[b].callback.call())}}angular.module("cpk").controller("GlobalController",
f).directive("ngModal",function(){return{restrict:"A",link:function(b,c,a){a=a.ngModal.split(".");b=a[0];a=a[1];"undefined"===typeof d.modal[b]&&(d.modal[b]={});d.modal[b][a]=c.context;g(b,a)}}});f.$inject=["$rootScope","$location","$log","$http"];var d={modal:{global:{body:void 0,header:void 0}}},e={modal:{}},h=void 0})();(function(){angular.module("cpk").filter("translate",function(){return function(f){return"translate"in VuFind?VuFind.translate(f):f}})})();
